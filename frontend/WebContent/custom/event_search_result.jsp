<%@ page pageEncoding="UTF-8"%>
<%@ page contentType="text/html; charset=UTF-8"%>
<%@ page import = "java.util.Vector, java.util.Calendar, java.util.StringTokenizer, java.text.SimpleDateFormat, java.sql.*, sun.jdbc.rowset.*, ausstage.*"%>
<%admin.AppConstants ausstage_search_appconstants_for_result = new admin.AppConstants(request);%><cms:include property="template" element="head" />

<jsp:useBean id="admin_db_for_result" class="ausstage.Database" scope="application">
<%admin_db_for_result.connDatabase(ausstage_search_appconstants_for_result.DB_PUBLIC_USER_NAME, ausstage_search_appconstants_for_result.DB_PUBLIC_USER_PASSWORD);%>
</jsp:useBean>
<%!
public String concatFields(Vector fields, String token) {
  String ret = "";
  for (int i=0; i<fields.size(); i++) {
    if (fields.elementAt(i) != null) {
        if (!(fields.elementAt(i)).equals("") && !ret.equals("")) {
          ret += token;
        }
        ret += fields.elementAt(i);
    }
  }
  return ret;
}

public String formatDate(String day, String month, String year) {
  if (year == null || year == "" ){
    return "";
  }
  Calendar calendar = Calendar.getInstance();
   
  SimpleDateFormat formatter = new SimpleDateFormat();
  if (month == null || month == "" ){
    formatter.applyPattern("yyyy");
    calendar.set(Calendar.YEAR , new Integer(year).intValue());
  
  }
  else if(day == null || day == "" ){
    formatter.applyPattern("MMM yyyy");
    calendar.set(Calendar.MONTH  ,new Integer(month).intValue() -1);
    calendar.set(Calendar.YEAR , new Integer(year).intValue());
    
  }
  else{
    formatter.applyPattern("dd MMM yyyy");
    calendar.set(Calendar.DAY_OF_MONTH  ,new Integer(day).intValue());
    calendar.set(Calendar.MONTH  ,new Integer(month).intValue() -1);
    calendar.set(Calendar.YEAR , new Integer(year).intValue());
  }
  java.util.Date date = calendar.getTime();
  String result = formatter.format(date);

  return result;
}
%>

<%
  String picture_australia_search_string;
  String australia_dancing_search_string;
  String google_search_string;
  
  ausstage.Database          db_ausstage_for_result       = new ausstage.Database ();
  admin.Common            common                       = new admin.Common   ();
  db_ausstage_for_result.connDatabase (AusstageCommon.AUSSTAGE_DB_USER_NAME, AusstageCommon.AUSSTAGE_DB_PASSWORD);

  CachedRowSet crset                     = null;
  Search search;
  String formatted_date                  = "";
  String keyword                         = request.getParameter("f_keyword");
  String table_to_search_from            = request.getParameter("f_search_from");
  String page_num                        = request.getParameter("f_page_num");
  String recset_count                    = request.getParameter("f_recset_count");
  String search_within_search_for_result = request.getParameter("f_search_within_search");
  int l_int_page_num                     = 0;
  State state                            = new State(db_ausstage_for_result);
  SimpleDateFormat formatPattern         = new SimpleDateFormat("dd/MM/yyyy");
  String xcid_for_result                 = request.getParameter("xcid");
  boolean do_print                       = false;
  // Secondary Rowset to be used in when crset is already in use i.e. when 
  CachedRowSet crset2                     = null;
  Statement stmt;
  String m_inc_resource                   = request.getParameter("inc_resources");
  int    resultsPerPage                   = 20;

  picture_australia_search_string = "http://www.pictureaustralia.org/apps/pictureaustralia?action=PASearch&mode=advanced&term1=" + common.URLEncode(keyword) + "&attribute1=any+field&loc1=&nr=9&op1=OR&term2=&attribute2=any+field&loc2=&op2=AND&term3=&attribute3=any+field&loc3=&Start+Adv+Search.x=20&Start+Adv+Search.y=14";
  australia_dancing_search_string = "http://www.australiadancing.org/apps/ad?action=PublicSearch&mode=All%20entries&y=16&x=17&gochunk=1-50&searchTerm=" + common.URLEncode(keyword);
  google_search_string            = "http://www.google.com.au/search?q=" + common.URLEncode(keyword);

    ///////////////////////////////////
    //    DISPLAY SEARCH RESULTS
    //////////////////////////////////
    // set the search_within_search_for_result variable
    if(search_within_search_for_result == null){search_within_search_for_result ="";}
    if(m_inc_resource != null && m_inc_resource.equals("null")){m_inc_resource = null;}

    int counter;
    int start_trigger;
    int curr_row = 0;      
    search = new Search(db_ausstage_for_result);
    
    // Make sure that a keyword has been entered. The user may have javascript disabled.
    if (keyword == null ||
        keyword.equals("null") ||
        keyword.equals("")) {
      search.setKeyWord("xxxxNoDataEnteredxx"); // Dummy string so that an error is not generated by the database 
    } 
    else {
      search.setKeyWord(keyword.trim());
    }

    search.setSqlSwitch(request.getParameter("f_sql_switch").toString());
    search.setSearchFor(table_to_search_from);
    search.setSortBy(request.getParameter("f_sort_by").toString());
    
    // check if the search is search within a search
    if(!search_within_search_for_result.equals(""))
      search.setSearchWithinResults((String) session.getAttribute("sub_search_str"));
    
    if(page_num != null){
      if(Integer.parseInt(page_num) > 1)
        curr_row = Integer.parseInt(page_num) * resultsPerPage - resultsPerPage;
    }else{
      recset_count = search.getRecordCount();
    }
    
    // Either all, or events with an associated resource, or events with an associated online resource - only to be done for Search All
    // default condition is to include resources

    if (m_inc_resource != null){
      search.setResourceVisible(m_inc_resource);
    }

   
    /**********************************************
      ALL OR EVENT RESULT
    **********************************************/
    if(table_to_search_from.equals("all") || table_to_search_from.equals("event")){
    
      // Dates are only part of the all and event searches
      String unformattedDate = request.getParameter("f_year");
      if(unformattedDate != null && !unformattedDate.equals("")){
        // Date can be in the form "1996" or "1996-2008"
        String yearFrom        = "";
        String yearTo          = "";
        if (unformattedDate.length() == 4) {
          yearTo = unformattedDate;
          yearFrom = unformattedDate;
        }
        else if (unformattedDate.length() == 9) {
          yearFrom = unformattedDate.substring(0, 4);
          yearTo = unformattedDate.substring(5);
        }
        else {
          // Invalid date, should not get here because of form submission validation
        }

        if (yearTo.length() == 4 && yearFrom.length() == 4) {
          search.setBetweenFromDate(yearFrom, "01", "01");
          search.setBetweenToDate(yearTo, "12", "31");
         }
      }
      
      
      
      if(table_to_search_from.equals("all"))
        crset = search.getAll();
      else
        crset = search.getEvents();


      // set the session here
      if(search_within_search_for_result.equals(""))
        session.setAttribute("sub_search_str", search.getSearchWithinResults());
      
      if(crset != null && crset.next()){
        // get the number of rows returned (1st time only)
        if(page_num == null){
          crset.last(); 
          recset_count = Integer.toString(crset.getRow());
          crset.first();         
        }

        out.println("     <table width=\"100%\" border=\"0\" cellpadding=\"3\" cellspacing=\"0\">");
        /*
        if (table_to_search_from.equals("all")) {
          out.println("      <tr><form name='resource_radio' id='resource_radio'>");
          out.print  ("       <td colspan=\"8\"" + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><INPUT TYPE='radio' name='inc_resources' id='inc_resources' value='' onclick='reloadList();' ");
          if (request.getParameter("inc_resources")==null || request.getParameter("inc_resources").equals("")) {
            out.print("checked");
          }
          out.println(">&nbsp;Display All");
          
          out.print ("       <br><INPUT TYPE='radio' name='inc_resources' id='inc_resources' value='Y' onclick='reloadList();'");
          if (request.getParameter("inc_resources")!=null && request.getParameter("inc_resources").equals("Y")) {
            out.print("checked");
          }
          out.println(">Only display Events with associated Resources");
          
          out.print ("       <br><INPUT TYPE='radio' name='inc_resources' id='inc_resources' value='ONLINE' onclick='reloadList();'");
          if (request.getParameter("inc_resources")!=null && request.getParameter("inc_resources").equals("ONLINE")) {
            out.print("checked");
          }
          out.print(">Only display Events with associated Online Resources");

          out.println("      </TD></form></tr>");
        }
*/
        // DISPLAY NUMBER OF RESULTS
        out.println("      <tr>");
        out.println("       <td colspan=\"8\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
        out.println("       <b>Search Results</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"8\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

        // SPECIFY THE MESSAGE WHETHER OR NOT THE SEARCH WITHIN RESULT WAS ACTIVATED
        //if(search_within_search_for_result.equals(""))
        out.print("       Your search found " + recset_count + " results.");
        out.print(" Click Event Name to view details.");

        // SEARCH WITHIN THE SEARCH RESULTS
        if(search_within_search_for_result.equals("")){
          //out.println("<a href=\""  + request.getRequestURI() + "?xcid=" + xcid_for_result + "&f_search_within_search=yes\">You can click here to search within this result.</a>");

          out.println(" Or <a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                      "&f_keyword=" + common.URLEncode(keyword) + 
                      "&f_search_from=" + table_to_search_from + 
                      "&f_recset_count=" + recset_count +
                      "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                      "&f_sort_by=" + request.getParameter("f_sort_by") +
                      "&f_date_clause=" + request.getParameter("f_date_clause") + 
                      "&f_search_within_search=yes" +
                      "&inc_resources=" + m_inc_resource +
                      "&f_year=" + unformattedDate +
                      "\">search again</a> within this result");
        } 

        // DISPLAY HEADERS AND TITLES
        out.println("       </td>");
        out.println("      </tr>");  
        out.println("      <tr>");
        out.println("       <td colspan=\"8\">&nbsp;</td>");
        out.println("      </tr>");

        out.println("      <tr>");
        out.println("       <td width=\"215\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Event Name</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"277\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Venue</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"80\" align='right' " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>First Date</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>"); // For Resource Image
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");

        counter       = 0;
        start_trigger = 0;
        do_print = false;

      

        // DISPLAY SEARCH RESULT(S)
        do{
          
          if(page_num == null){
            do_print = true;
          }else if(page_num.equals("1")){
            do_print = true;
          }else{
            if((Integer.parseInt(page_num) * resultsPerPage - resultsPerPage) == start_trigger)
              do_print = true;
          }
          
          if(do_print){

            String bgcolour = "";
            if ((counter%2) == 0 ) // is it odd or even number???
              bgcolour = "bgcolor='#e3e3e3'";
            else
              bgcolour = "bgcolor='#FFFFFF'";


            out.println("      <tr>");              
            
            
            
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"215\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><a href=\"" + AusstageCommon.event_index_search_result_drill_page + "&f_event_id=" + crset.getString("eventid") + "\" onmouseover=\"this.style.cursor='hand';\">" + crset.getString("event_name") + " (" + crset.getString("eventid") + ")" + "</a></td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.print("       <td " + bgcolour +  " valign=\"top\" width=\"277\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");






            String venDisplay = "";
            if(crset.getString("venue_name") != null) {
              venDisplay = crset.getString("venue_name");
            }

            if(crset.getString("suburb") != null) {
              if (!venDisplay.equals("")) {
                venDisplay += ", ";
              }
              venDisplay += crset.getString("suburb");
            }
            
            if(crset.getString("venue_state") != null) {
              if (!venDisplay.equals("")) {
                venDisplay += ", ";
              }
              venDisplay += crset.getString("venue_state");
            }
            out.println(venDisplay + "</td>");
            
            
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.println("       <td " + bgcolour +  " valign=\"top\" align ='right' width=\"80\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

            formatted_date = "";
            Event eventObj = new Event(db_ausstage_for_result);            
            CachedRowSet event_crset = eventObj.getEventsById(crset.getString("eventid"));  
            event_crset.next();

            //Vector firstDateVector = new Vector();
            //firstDateVector.addElement(event_crset.getString("DDFIRST_DATE"));
            //firstDateVector.addElement(event_crset.getString("MMFIRST_DATE"));
            //firstDateVector.addElement(event_crset.getString("YYYYFIRST_DATE"));
            //out.println(concatFields(firstDateVector, "/"));
            out.println(formatDate(event_crset.getString("DDFIRST_DATE"), event_crset.getString("MMFIRST_DATE"),event_crset.getString("YYYYFIRST_DATE") ));
            out.println("</td>");

            // Requirement: show image if event has an associated ONLINE resource.
            // The block runs for a search on: 
            //  - ALL, has no eventid => prevent from erroring
            //  - Events => definitely run
            // only can show image if the eventid is in the result set of crset
            if (crset.findColumn("resource_flag") > -1){
              if (crset.getString("resource_flag").equals("ONLINE")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongreen.gif' alt='Related Resource'></td>"); // For Resource Image
              }
              else if (crset.getString("resource_flag").equals("Y")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongrey.gif' alt='Related Resource'></td>"); // For Resource Image
              }else {
                out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>"); // For no online Resource Image
              }
            }

            out.println(      "</tr>");

            counter++;
                        
            if(counter == resultsPerPage)
              break;
          }
          
          start_trigger++;
          
        }while(crset.next());

       
        // PAGINATION DISPLAY //

        String unrounded_page_num = "";
        int rounded_num_pages     = 0;
        int remainder_num         = 0;
        int int_page_num          = 0;
        int i                     = 1;
          
        
        if(Integer.parseInt(recset_count) > resultsPerPage){
       
          out.println("      <tr>");
          out.println("       <td colspan=\"7\">&nbsp;</td>");
          out.println("      </tr>");
          out.println("      <tr>");
          out.println("       <td align=\"center\" colspan=\"7\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
         
          unrounded_page_num  = Double.toString(Double.parseDouble(Integer.toString(Integer.parseInt(recset_count))) / Double.parseDouble(resultsPerPage+""));
          rounded_num_pages   = Integer.parseInt(unrounded_page_num.substring(0, unrounded_page_num.indexOf(".")));     // ie. 5.4 will return 5    
          remainder_num       = Integer.parseInt(unrounded_page_num.substring(unrounded_page_num.indexOf(".") + 1, unrounded_page_num.indexOf(".") + 2)); // ie. 5.4 will return 4          
          
          
          
          if(remainder_num > 0)
            rounded_num_pages++; // add another page if remainder > 0

          // convert the page_num to a useful mathematical type
          // and use it as the start number for our page numbering
          if(page_num != null){
            int_page_num = Integer.parseInt(page_num);

            // find the middle number so that if 10 is
            // hit(or the 'Next' & 'Previous' number)
            // the page number will display
            // 6 7 8 9 10 11 12 13 14 15
            if(int_page_num >= 10)
              i = int_page_num - 4;
          }


          
          out.println("<b>Result Page</b>:&nbsp;&nbsp;");
          
          // write Previous
          if(int_page_num > 1)
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num - 1) + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_date_clause=" + request.getParameter("f_date_clause") + 
                        "&f_search_within_search=" + search_within_search_for_result +
                        "&inc_resources=" + m_inc_resource +
                        "&f_year=" + unformattedDate +
                        "\">Previous</a>&nbsp;");

          
          // write page numbers
          counter = 0;
          for(; i < rounded_num_pages + 1; i++){
            String highlight_number_str = "";

            if(int_page_num == i)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else if(page_num == null && i == 1)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else
              highlight_number_str = Integer.toString(i);
              
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + i + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_date_clause=" + request.getParameter("f_date_clause") +    
                        "&f_search_within_search=" + search_within_search_for_result +
                        "&inc_resources=" + m_inc_resource +
                        "&f_year=" + unformattedDate +
                        "\">" + highlight_number_str + "</a>&nbsp;");

            counter++;
            if(counter == 10)
              break;
          }

          // write Next
          if(page_num != null){
            if((int_page_num) < rounded_num_pages){// display Next only if its under the rounded_num_pages count
              out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                          "&f_keyword=" + common.URLEncode(keyword) + 
                          "&f_search_from=" + table_to_search_from + 
                          "&f_page_num=" + (int_page_num + 1) + 
                          "&f_recset_count=" + recset_count + 
                          "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                          "&f_sort_by=" + request.getParameter("f_sort_by") +
                          "&f_date_clause=" + request.getParameter("f_date_clause") + 
                          "&f_search_within_search=" + search_within_search_for_result +
                          "&inc_resources=" + m_inc_resource +
                          "&f_year=" + unformattedDate +
                          "\">Next</a>");
            }
          }else{
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num + 2) + 
                        "&f_recset_count=" + recset_count +
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_date_clause=" + request.getParameter("f_date_clause") + 
                        "&f_search_within_search=" + search_within_search_for_result +
                        "&inc_resources=" + m_inc_resource +
                        "&f_year=" + unformattedDate +
                        "\">Next</a>");
          }
              
          out.println("       </td>");
          out.println("      </tr>");
        } 
        
        // External links to other sites
        out.println("      <tr>");
        out.println("       <td colspan='7' "+ ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><br><br>");
        //out.println("         <a target='_blank' href='" + AusstageCommon.collection_index_search_result_page + "&f_keyword=" + common.URLEncode(keyword) + "&f_sql_switch=and'>Click here</a> to search the Directory</a><br>");
        out.println("         Search <a target='_blank' href='" + google_search_string + "'>Google</a><br>");
        out.println("         Search <a target='_blank' href='" + picture_australia_search_string + "'>Picture Australia</a><br>");
        out.println("         Search <a target='_blank' href='" + australia_dancing_search_string + "'>Australia Dancing</a><br>");
        out.println("       </td>");
        out.println("      </tr> ");
        
        
        out.println("     </table>");
     
      }else{
        out.println("<p " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + 
                    ">Your search did not return any result.<br>Please refine " +
                    "your search criteria.</p>");
      }


      
    }else if (table_to_search_from.equals("venue")){

    /**********************************************
      VENUE RESULT
    **********************************************/
          
      crset = search.getVenues();

      // set the session here
      if(search_within_search_for_result.equals(""))
        session.setAttribute("sub_search_str", search.getSearchWithinResults());
      
      if(crset != null && crset.next()){

        // get the number of rows returned (1st time only)
        if(page_num == null){
          crset.last(); 
          recset_count = Integer.toString(crset.getRow());
          crset.first();         
        }

        out.println("     <table width='100%' border=\"0\" cellpadding=\"3\" cellspacing=\"0\">");

        // DISPLAY NUMBER OF RESULTS
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
        out.println("       <b>Search Results</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

        // SPECIFY THE MESSAGE WHETHER OR NOT THE SEARCH WITHIN RESULT WAS ACTIVATED
        //if(search_within_search_for_result.equals(""))
          out.println("       Your search found " + recset_count + " results.");
        out.print(" Click Venue Name to view details.");
          
        //else
          //out.println("       Your search within the previous result found " + recset_count + " results.");

        // SEARCH WITHIN THE SEARCH RESULTS
        if(search_within_search_for_result.equals("")){
          //out.println("<a href=\""  + request.getRequestURI() + "?xcid=" + xcid_for_result + "&f_search_within_search=yes\">You can click here to search within this result.</a>");

          out.println(" Or <a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                      "&f_keyword=" + common.URLEncode(keyword) + 
                      "&f_search_from=" + table_to_search_from + 
                      "&f_recset_count=" + recset_count +
                      "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                      "&f_sort_by=" + request.getParameter("f_sort_by") +                      
                      "&f_search_within_search=yes" +
                      "\">search again</a> within this result");


        } 

        // DISPLAY HEADERS AND TITLES
        out.println("       </td>");
        out.println("      </tr>");        
        out.println("      <tr>");
        out.println("       <td colspan=\"7\">&nbsp;</td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td width=\"215\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Venue Name</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"277\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Address</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"80\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Web Links</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");

        counter       = 0;
        start_trigger = 0;
        do_print = false;
        

        // DISPLAY SEARCH RESULT(S)
        do{

          if(page_num == null){
            do_print = true;
          }else if(page_num.equals("1")){
            do_print = true;
          }else{
            if((Integer.parseInt(page_num) * resultsPerPage - resultsPerPage) == start_trigger)
              do_print = true;
          }
          
          if(do_print){

            String bgcolour = "";
            if ((counter%2) == 0 ) // is it odd or even number???
              bgcolour = "bgcolor='#e3e3e3'";
            else
              bgcolour = "bgcolor='#FFFFFF'";          
          
            out.println("      <tr>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"215\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><a href=\"" + AusstageCommon.event_index_search_result_drill_page + "&f_venue_id=" + crset.getString("venueid") + "\" onmouseover=\"this.style.cursor='hand';\">" + crset.getString("venue_name") + " (" + crset.getString("venueid") + ")" + "</a></td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"277\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

            if(crset.getString("street") != null)
              out.println(crset.getString("street") + ", ");
              
            if(crset.getString("suburb") != null)
              out.println(crset.getString("suburb")  + ", ");

            if(crset.getString("venue_state") != null)
              out.println(crset.getString("venue_state"));
            
            out.print("         </td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"80\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

            if(crset.getString("web_links") != null){
              out.println("<a href=\"");
              if(crset.getString("web_links").indexOf("http://") < 0)
                out.println("http://");
              out.println(crset.getString("web_links") + "\">" + crset.getString("web_links") + "</a>");
            }
            
            out.println(      "</td>");
            
            if (crset.findColumn("resource_flag") > -1){
              if (crset.getString("resource_flag").equals("ONLINE")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongreen.gif' alt='Related Online Resource'></td>"); // For Resource Image
              }
              else if (crset.getString("resource_flag").equals("Y")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongrey.gif' alt='Related Resource'></td>"); // For Resource Image
              }else {
                out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>"); // For no online Resource Image
              }
            }
            out.println("</tr>");

            counter++;
                        
            if(counter == resultsPerPage)
              break;
          }
          
          start_trigger++;
          
        }while(crset.next());
       

        // PAGINATION DISPLAY //

        String unrounded_page_num = "";
        int rounded_num_pages     = 0;
        int remainder_num         = 0;
        int int_page_num          = 0;
        int i                     = 1;
          
        
        if(Integer.parseInt(recset_count) > resultsPerPage){
       
          out.println("      <tr>");
          out.println("       <td colspan=\"7\">&nbsp;</td>");
          out.println("      </tr>");
          out.println("      <tr>");
          out.println("       <td align=\"center\" colspan=\"7\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
         
          unrounded_page_num  = Double.toString(Double.parseDouble(Integer.toString(Integer.parseInt(recset_count))) / Double.parseDouble(resultsPerPage + ""));
          rounded_num_pages   = Integer.parseInt(unrounded_page_num.substring(0, unrounded_page_num.indexOf(".")));     // ie. 5.4 will return 5    
          remainder_num       = Integer.parseInt(unrounded_page_num.substring(unrounded_page_num.indexOf(".") + 1, unrounded_page_num.indexOf(".") + 2)); // ie. 5.4 will return 4          
          
          
          
          if(remainder_num > 0)
            rounded_num_pages++; // add another page if remainder > 0

          // convert the page_num to a useful mathematical type
          // and use it as the start number for our page numbering
          if(page_num != null){
            int_page_num = Integer.parseInt(page_num);

            // find the middle number so that if 10 is
            // hit(or the 'Next' & 'Previous' number)
            // the page number will display
            // 6 7 8 9 10 11 12 13 14 15
            if(int_page_num >= 10)
              i = int_page_num - 4;
          }


          
          out.println("<b>Result Page</b>:&nbsp;&nbsp;");
          
          // write Previous
          if(int_page_num > 1)
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num - 1) + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Previous</a>&nbsp;");

          
          // write page numbers
          counter = 0;
          for(; i < rounded_num_pages + 1; i++){
            String highlight_number_str = "";

            if(int_page_num == i)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else if(page_num == null && i == 1)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else
              highlight_number_str = Integer.toString(i);
              
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + i + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") + 
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">" + highlight_number_str + "</a>&nbsp;");

            counter++;
            if(counter == 10)
              break;
          }

          // write Next
          if(page_num != null){
            if((int_page_num) < rounded_num_pages){// display Next only if its under the rounded_num_pages count
              out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                          "&f_keyword=" + common.URLEncode(keyword) + 
                          "&f_search_from=" + table_to_search_from + 
                          "&f_page_num=" + (int_page_num + 1) + 
                          "&f_recset_count=" + recset_count + 
                          "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                          "&f_sort_by=" + request.getParameter("f_sort_by") +
                          "&f_search_within_search=" + search_within_search_for_result +
                          "\">Next</a>");
            }
          }else{
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num + 2) + 
                        "&f_recset_count=" + recset_count +
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Next</a>");
          }
              
          out.println("       </td>");
          out.println("      </tr>");
        } 

        // External links to other sites
        out.println("      <tr>");
        out.println("       <td colspan='7' "+ ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><br><br>");
        //out.println("         <a target='_blank' href='" + AusstageCommon.collection_index_search_result_page + "&f_keyword=" + common.URLEncode(keyword) + "&f_sql_switch=and'>Click here</a> to search the Directory</a><br>");
        out.println("         Search <a target='_blank' href='" + google_search_string + "'>Google</a><br>");
        out.println("         Search <a target='_blank' href='" + picture_australia_search_string + "'>Picture Australia</a><br>");
        out.println("         Search <a target='_blank' href='" + australia_dancing_search_string + "'>Australia Dancing</a><br>");
        out.println("       </td>");
        out.println("      </tr> ");
        
        out.println("     </table>");
     
      }else{
        out.println("<p " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + 
                    ">Your search did not return any result.<br>Please refine " +
                    "your search criteria.</p>");
      }

      
    }else if (table_to_search_from.equals("contributor")){
    
    /**********************************************
      CONTRIBUTOR RESULT
    **********************************************/
    
      if(request.getParameter("f_year") != null && !request.getParameter("f_year").equals("")){
        // Date can be in the form "1996" or "1996-2008"
        String unformattedDate = request.getParameter("f_year");
        String yearFrom        = "";
        String yearTo          = "";
        if (unformattedDate.length() == 4) {
          yearTo = unformattedDate;
          yearFrom = unformattedDate;
        }
        else if (unformattedDate.length() == 9) {
          yearFrom = unformattedDate.substring(0, 4);
          yearTo = unformattedDate.substring(5);
        }
        else {
          // Invalid date, should not get here because of form submission validation
        }

        if (yearTo.length() == 4 && yearFrom.length() == 4) {
          search.setBetweenFromDate(yearFrom, "01", "01");
          search.setBetweenToDate(yearTo, "12", "31");
         }
      } 
      
      crset = search.getContributors();
      // set the session here
      if(search_within_search_for_result.equals(""))
        session.setAttribute("sub_search_str", search.getSearchWithinResults());
      
      if(crset != null && crset.next()){

        // get the number of rows returned (1st time only)
        if(page_num == null){
          crset.last(); 
          recset_count = Integer.toString(crset.getRow());
          crset.first();         
        }

        out.println("     <table width='100%' border=\"0\" cellpadding=\"3\" cellspacing=\"0\">");

        // DISPLAY NUMBER OF RESULTS
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
        out.println("       <b>Search Results</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

        // SPECIFY THE MESSAGE WHETHER OR NOT THE SEARCH WITHIN RESULT WAS ACTIVATED
        //if(search_within_search_for_result.equals(""))
          out.println("       Your search found " + recset_count + " results.");
        out.print(" Click Contributor Name to view details.");
        //else
          //out.println("       Your search within the previous result found " + recset_count + " results.");

        // SEARCH WITHIN THE SEARCH RESULTS
        if(search_within_search_for_result.equals("")){
          //out.println("<a href=\""  + request.getRequestURI() + "?xcid=" + xcid_for_result + "&f_search_within_search=yes\">You can click here to search within this result.</a>");

          out.println(" Or <a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                      "&f_keyword=" + common.URLEncode(keyword) + 
                      "&f_search_from=" + table_to_search_from + 
                      "&f_recset_count=" + recset_count +
                      "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                      "&f_sort_by=" + request.getParameter("f_sort_by") +                      
                      "&f_search_within_search=yes" +
                      "\">search again</a> within this result");


        } 

        // DISPLAY HEADERS AND TITLES
        out.println("       </td>");
        out.println("      </tr>");        
        out.println("      <tr>");
        out.println("       <td colspan=\"7\">&nbsp;</td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td width=\"250\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Name</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"100\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Event Dates</b></td>");
        //out.println("       <td width=\"104\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Nationality</b></td>");
        //out.println("       <td width=\"53\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>DOB</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"200\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Functions</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");

        counter       = 0;
        start_trigger = 0;
        do_print = false;
        

        // DISPLAY SEARCH RESULT(S)
        do{

          if(page_num == null){
            do_print = true;
          }else if(page_num.equals("1")){
            do_print = true;
          }else{
            if((Integer.parseInt(page_num) * resultsPerPage - resultsPerPage) == start_trigger)
              do_print = true;
          }
          
          if(do_print){

            String bgcolour = "";
            if ((counter%2) == 0 ) // is it odd or even number???
              bgcolour = "bgcolor='#e3e3e3'";
            else
              bgcolour = "bgcolor='#FFFFFF'";
              
            out.println("      <tr>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"250\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><a href=\"" + AusstageCommon.event_index_search_result_drill_page + "&f_contrib_id=" + crset.getString("contributorid") + "\" onmouseover=\"this.style.cursor='hand';\">" + crset.getString("contrib_name") + " (" + crset.getString("contributorid") + ")" + "</a></td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"100\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");


            if(crset.getString("event_dates") != null)
              out.println(crset.getString("event_dates"));
              
            out.println("       </td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.print("       <td " + bgcolour +  " valign=\"top\" width=\"200\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");


            if(crset.getString("contributorid") != null && !crset.getString("contributorid").equals("")){
              Contributor contributor = new Contributor(db_ausstage_for_result);
              contributor.load(Integer.parseInt(crset.getString("contributorid")));
              String contribFunctions = "";
              String contFunctIds     = contributor.getContFunctIds(); 
              CachedRowSet rset       = null;

              if(!contFunctIds.equals("")){
                if(contFunctIds.indexOf(",") != -1){
                  StringTokenizer str_token = new StringTokenizer(contFunctIds,","); 
                  while(str_token.hasMoreTokens()){
                    rset = contributor.getContFunctPreff(Integer.parseInt(str_token.nextToken()));
                    if(rset.next()){
                      if(contribFunctions.equals(""))
                        contribFunctions = rset.getString("PREFERREDTERM");
                      else
                        contribFunctions += ", " + rset.getString("PREFERREDTERM"); 
                    }
                  }
                }else{
                  rset = contributor.getContFunctPreff(Integer.parseInt(contFunctIds));
                  rset.next();
                  contribFunctions = rset.getString("PREFERREDTERM");
                }
              }
              //ausstage.Contributor cont = new ausstage.Contributor(db_ausstage_for_result);

              
              //String contribFunctions = contributor.getContFunctPreffTermByContributor(crset.getString("contributorid"));
              if(contribFunctions != null && !contribFunctions.equals(""))
                out.print(contribFunctions);              
            }
            
            out.println(      "</td>");

            if (crset.findColumn("resource_flag") > -1){
              if (crset.getString("resource_flag").equals("ONLINE")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongreen.gif' alt='Related Online Resource'></td>"); // For Resource Image
              }
              else if (crset.getString("resource_flag").equals("Y")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongrey.gif' alt='Related Resource'></td>"); // For Resource Image
              }else {
                out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>"); // For no online Resource Image
              }
            }
            out.println("</tr>");
            counter++;
                        
            if(counter == resultsPerPage)
              break;
          }
          
          start_trigger++;
          
        }while(crset.next());
       

        // PAGINATION DISPLAY //

        String unrounded_page_num = "";
        int rounded_num_pages     = 0;
        int remainder_num         = 0;
        int int_page_num          = 0;
        int i                     = 1;
          
        
        if(Integer.parseInt(recset_count) > resultsPerPage){
       
          out.println("      <tr>");
          out.println("       <td colspan=\"7\">&nbsp;</td>");
          out.println("      </tr>");
          out.println("      <tr>");
          out.println("       <td align=\"center\" colspan=\"7\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
         
          unrounded_page_num  = Double.toString(Double.parseDouble(Integer.toString(Integer.parseInt(recset_count))) / Double.parseDouble(resultsPerPage + ""));
          rounded_num_pages   = Integer.parseInt(unrounded_page_num.substring(0, unrounded_page_num.indexOf(".")));     // ie. 5.4 will return 5    
          remainder_num       = Integer.parseInt(unrounded_page_num.substring(unrounded_page_num.indexOf(".") + 1, unrounded_page_num.indexOf(".") + 2)); // ie. 5.4 will return 4          
          
          
          
          if(remainder_num > 0)
            rounded_num_pages++; // add another page if remainder > 0

          // convert the page_num to a useful mathematical type
          // and use it as the start number for our page numbering
          if(page_num != null){
            int_page_num = Integer.parseInt(page_num);

            // find the middle number so that if 10 is
            // hit(or the 'Next' & 'Previous' number)
            // the page number will display
            // 6 7 8 9 10 11 12 13 14 15
            if(int_page_num >= 10)
              i = int_page_num - 4;
          }


          
          out.println("<b>Result Page</b>:&nbsp;&nbsp;");
          
          // write Previous
          if(int_page_num > 1)
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num - 1) + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Previous</a>&nbsp;");

          
          // write page numbers
          counter = 0;
          for(; i < rounded_num_pages + 1; i++){
            String highlight_number_str = "";

            if(int_page_num == i)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else if(page_num == null && i == 1)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else
              highlight_number_str = Integer.toString(i);
              
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + i + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") + 
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">" + highlight_number_str + "</a>&nbsp;");

            counter++;
            if(counter == 10)
              break;
          }

          // write Next
          if(page_num != null){
            if((int_page_num) < rounded_num_pages){// display Next only if its under the rounded_num_pages count
              out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                          "&f_keyword=" + common.URLEncode(keyword) + 
                          "&f_search_from=" + table_to_search_from + 
                          "&f_page_num=" + (int_page_num + 1) + 
                          "&f_recset_count=" + recset_count + 
                          "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                          "&f_sort_by=" + request.getParameter("f_sort_by") +
                          "&f_search_within_search=" + search_within_search_for_result +
                          "\">Next</a>");
            }
          }else{
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num + 2) + 
                        "&f_recset_count=" + recset_count +
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Next</a>");
          }
              
          out.println("       </td>");
          out.println("      </tr>");
        } 

        // External links to other sites
        out.println("      <tr>");
        out.println("       <td colspan='7' "+ ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><br><br>");
        //out.println("         <a target='_blank' href='" + AusstageCommon.collection_index_search_result_page + "&f_keyword=" + common.URLEncode(keyword) + "&f_sql_switch=and'>Click here</a> to search the Directory</a><br>");
        out.println("         Search <a target='_blank' href='" + google_search_string + "'>Google</a><br>");
        out.println("         Search <a target='_blank' href='" + picture_australia_search_string + "'>Picture Australia</a><br>");
        out.println("         Search <a target='_blank' href='" + australia_dancing_search_string + "'>Australia Dancing</a><br>");        out.println("       </td>");
        out.println("      </tr> ");
        
        out.println("     </table>");
     
      }else{
        out.println("<p " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + 
                    ">Your search did not return any result.<br>Please refine " +
                    "your search criteria.</p>");
      }    
    }else if (table_to_search_from.equals("organisation")){
    
    /**********************************************
      ORGANISATION RESULT
    **********************************************/
          
      crset = search.getOrganisations();

      // set the session here
      if(search_within_search_for_result.equals(""))
        session.setAttribute("sub_search_str", search.getSearchWithinResults());
      
      if(crset != null && crset.next()){

        // get the number of rows returned (1st time only)
        if(page_num == null){
          crset.last(); 
          recset_count = Integer.toString(crset.getRow());
          crset.first();         
        }

        out.println("     <table width='100%' border=\"0\" cellpadding=\"3\" cellspacing=\"0\">");

        // DISPLAY NUMBER OF RESULTS
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
        out.println("       <b>Search Results</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

        // SPECIFY THE MESSAGE WHETHER OR NOT THE SEARCH WITHIN RESULT WAS ACTIVATED
        //if(search_within_search_for_result.equals(""))
          out.println("       Your search found " + recset_count + " results.");
        out.print(" Click Organisation Name to view details.");
        //else
          //out.println("       Your search within the previous result found " + recset_count + " results.");

        // SEARCH WITHIN THE SEARCH RESULTS
        if(search_within_search_for_result.equals("")){
          //out.println("<a href=\""  + request.getRequestURI() + "?xcid=" + xcid_for_result + "&f_search_within_search=yes\">You can click here to search within this result.</a>");

          out.println(" Or <a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                      "&f_keyword=" + common.URLEncode(keyword) + 
                      "&f_search_from=" + table_to_search_from + 
                      "&f_recset_count=" + recset_count +
                      "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                      "&f_sort_by=" + request.getParameter("f_sort_by") +                      
                      "&f_search_within_search=yes" +
                      "\">search again</a> within this result");


        } 

        // DISPLAY HEADERS AND TITLES
        out.println("       </td>");
        out.println("      </tr>");        

        out.println("      <tr>");
        out.println("       <td colspan=\"7\">&nbsp;</td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td width=\"215\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Organisation Name</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"277\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Address</b></td>");
        out.println("       <td width=\"1\">&nbsp;</td>");
        out.println("       <td width=\"80\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Web Links</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");

        counter       = 0;
        start_trigger = 0;
        do_print = false;
        

        // DISPLAY SEARCH RESULT(S)
        do{

          if(page_num == null){
            do_print = true;
          }else if(page_num.equals("1")){
            do_print = true;
          }else{
            if((Integer.parseInt(page_num) * resultsPerPage - resultsPerPage) == start_trigger)
              do_print = true;
          }
          
          if(do_print){

            String bgcolour = "";
            if ((counter%2) == 0 ) // is it odd or even number???
              bgcolour = "bgcolor='#e3e3e3'";
            else
              bgcolour = "bgcolor='#FFFFFF'";
              
            out.println("      <tr>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\215\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><a href=\"" + AusstageCommon.event_index_search_result_drill_page + "&f_org_id=" + crset.getString("organisationid") + "\" onmouseover=\"this.style.cursor='hand';\">" + crset.getString("name") + " (" + crset.getString("organisationid") + ")" + "</a></td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"277\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

            String orgDisplay = "";
            if(crset.getString("address") != null) {
              orgDisplay = crset.getString("address");
            }

            if(crset.getString("suburb") != null) {
              if (!orgDisplay.equals("")) {
                orgDisplay += ", ";
              }
              orgDisplay += crset.getString("suburb");
            }
            
            if(crset.getString("org_state") != null) {
              if (!orgDisplay.equals("")) {
                orgDisplay += ", ";
              }
              orgDisplay += crset.getString("org_state");
            }

            if (orgDisplay.equals("")) {
              orgDisplay += "&nbsp;";
            }
            out.println(orgDisplay);              
            
            out.print("         </td>");
            out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>");
            out.println("       <td " + bgcolour +  " valign=\"top\" width=\"80\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

            if(crset.getString("web_links") != null){
              out.println("<a href=\"");
              if(crset.getString("web_links").indexOf("http://") < 0)
                out.println("http://");
              out.println(crset.getString("web_links") + "\">" + crset.getString("web_links") + "</a>");
            }
            else{
              out.println("&nbsp;");            
            }
            
            out.println(      "</td>");

            if (crset.findColumn("resource_flag") > -1){
              if (crset.getString("resource_flag").equals("ONLINE")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongreen.gif' alt='Related Online Resource'></td>"); // For Resource Image
              }
              else if (crset.getString("resource_flag").equals("Y")) {
                out.println("       <td " + bgcolour +  " width=\"1\"><img src='/custom/ausstage/images/resourceicongrey.gif' alt='Related Resource'></td>"); // For Resource Image
              }else {
                out.println("       <td " + bgcolour +  " width=\"1\">&nbsp;</td>"); // For no online Resource Image
              }
            }
            out.println("</tr>");

            counter++;
                        
            if(counter == resultsPerPage)
              break;
          }
          
          start_trigger++;
          
        }while(crset.next());
       

        // PAGINATION DISPLAY //

        String unrounded_page_num = "";
        int rounded_num_pages     = 0;
        int remainder_num         = 0;
        int int_page_num          = 0;
        int i                     = 1;
          
        
        if(Integer.parseInt(recset_count) > resultsPerPage){
       
          out.println("      <tr>");
          out.println("       <td colspan=\"7\">&nbsp;</td>");
          out.println("      </tr>");
          out.println("      <tr>");
          out.println("       <td align=\"center\" colspan=\"7\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
         
          unrounded_page_num  = Double.toString(Double.parseDouble(Integer.toString(Integer.parseInt(recset_count))) / Double.parseDouble(resultsPerPage + ""));
          rounded_num_pages   = Integer.parseInt(unrounded_page_num.substring(0, unrounded_page_num.indexOf(".")));     // ie. 5.4 will return 5    
          remainder_num       = Integer.parseInt(unrounded_page_num.substring(unrounded_page_num.indexOf(".") + 1, unrounded_page_num.indexOf(".") + 2)); // ie. 5.4 will return 4          
          
          
          
          if(remainder_num > 0)
            rounded_num_pages++; // add another page if remainder > 0

          // convert the page_num to a useful mathematical type
          // and use it as the start number for our page numbering
          if(page_num != null){
            int_page_num = Integer.parseInt(page_num);

            // find the middle number so that if 10 is
            // hit(or the 'Next' & 'Previous' number)
            // the page number will display
            // 6 7 8 9 10 11 12 13 14 15
            if(int_page_num >= 10)
              i = int_page_num - 4;
          }


          
          out.println("<b>Result Page</b>:&nbsp;&nbsp;");
          
          // write Previous
          if(int_page_num > 1)
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num - 1) + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Previous</a>&nbsp;");

          
          // write page numbers
          counter = 0;
          for(; i < rounded_num_pages + 1; i++){
            String highlight_number_str = "";

            if(int_page_num == i)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else if(page_num == null && i == 1)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else
              highlight_number_str = Integer.toString(i);
              
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + i + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") + 
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">" + highlight_number_str + "</a>&nbsp;");

            counter++;
            if(counter == 10)
              break;
          }

          // write Next
          if(page_num != null){
            if((int_page_num) < rounded_num_pages){// display Next only if its under the rounded_num_pages count
              out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                          "&f_keyword=" + common.URLEncode(keyword) + 
                          "&f_search_from=" + table_to_search_from + 
                          "&f_page_num=" + (int_page_num + 1) + 
                          "&f_recset_count=" + recset_count + 
                          "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                          "&f_sort_by=" + request.getParameter("f_sort_by") +
                          "&f_search_within_search=" + search_within_search_for_result +
                          "\">Next</a>");
            }
          }else{
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num + 2) + 
                        "&f_recset_count=" + recset_count +
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Next</a>");
          }
              
          out.println("       </td>");
          out.println("      </tr>");
        } 

        // External links to other sites
        out.println("      <tr>");
        out.println("       <td colspan='7' "+ ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><br><br>");
        //out.println("         <a target='_blank' href='" + AusstageCommon.collection_index_search_result_page + "&f_keyword=" + common.URLEncode(keyword) + "&f_sql_switch=and'>Click here</a> to search the Directory</a><br>");
        out.println("         Search <a target='_blank' href='" + google_search_string + "'>Google</a><br>");
        out.println("         Search <a target='_blank' href='" + picture_australia_search_string + "'>Picture Australia</a><br>");
        out.println("         Search <a target='_blank' href='" + australia_dancing_search_string + "'>Australia Dancing</a><br>");        out.println("       </td>");
        out.println("      </tr> ");
        
        out.println("     </table>");
     
      }else{
        out.println("<p " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + 
                    ">Your search did not return any result.<br>Please refine " +
                    "your search criteria.</p>");
       }    
      
      
      
      }else if (table_to_search_from.equals("resource")){
    
    /**********************************************
      Resource RESULT
    **********************************************/
      if(request.getParameter("f_year") != null && !request.getParameter("f_year").equals("")){
        // Date can be in the form "1996" or "1996-2008"
        String unformattedDate = request.getParameter("f_year");
        String yearFrom        = "";
        String yearTo          = "";
        if (unformattedDate.length() == 4) {
          yearTo = unformattedDate;
          yearFrom = unformattedDate;
        }
        else if (unformattedDate.length() == 9) {
          yearFrom = unformattedDate.substring(0, 4);
          yearTo = unformattedDate.substring(5);
        }
        else {
          // Invalid date, should not get here because of form submission validation
        }

        if (yearTo.length() == 4 && yearFrom.length() == 4) {
          search.setBetweenFromDate(yearFrom, "01", "01");
          search.setBetweenToDate(yearTo, "12", "31");
         }
      }   
      crset = search.getResources();

      // set the session here
      if(search_within_search_for_result.equals(""))
        session.setAttribute("sub_search_str", search.getSearchWithinResults());
      
      if(crset != null && crset.next()){

        // get the number of rows returned (1st time only)
        if(page_num == null){
          crset.last(); 
          recset_count = Integer.toString(crset.getRow());
          crset.first();         
        }

        out.println("     <table width='100%' border=\"0\" cellpadding=\"3\" cellspacing=\"0\">");

        // DISPLAY NUMBER OF RESULTS
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
        out.println("       <b>Search Results</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"  " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");

        // SPECIFY THE MESSAGE WHETHER OR NOT THE SEARCH WITHIN RESULT WAS ACTIVATED
        //if(search_within_search_for_result.equals(""))
          out.println("       Your search found " + recset_count + " results.");
        out.print(" Click Resource Citation to view details.");
        //else
          //out.println("       Your search within the previous result found " + recset_count + " results.");

        // SEARCH WITHIN THE SEARCH RESULTS
        if(search_within_search_for_result.equals("")){
          //out.println("<a href=\""  + request.getRequestURI() + "?xcid=" + xcid_for_result + "&f_search_within_search=yes\">You can click here to search within this result.</a>");

          out.println(" Or <a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                      "&f_keyword=" + common.URLEncode(keyword) + 
                      "&f_search_from=" + table_to_search_from + 
                      "&f_recset_count=" + recset_count +
                      "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                      "&f_sort_by=" + request.getParameter("f_sort_by") +                      
                      "&f_search_within_search=yes" +
                      "\">search again</a> within this result");


        } 

        // DISPLAY HEADERS AND TITLES
        out.println("       </td>");
        out.println("      </tr>");        

        out.println("      <tr>");
        out.println("       <td colspan=\"7\">&nbsp;</td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td width=\"600\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><b>Citation</b></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");
        out.println("      <tr>");
        out.println("       <td colspan=\"7\"></td>");
        out.println("      </tr>");

        counter       = 0;
        start_trigger = 0;
        do_print = false;
        

        // DISPLAY SEARCH RESULT(S)
        do{

          if(page_num == null){
            do_print = true;
          }else if(page_num.equals("1")){
            do_print = true;
          }else{
            if((Integer.parseInt(page_num) * resultsPerPage - resultsPerPage) == start_trigger)
              do_print = true;
          }
          
          if(do_print){

            String bgcolour = "";
            if ((counter%2) == 0 ) // is it odd or even number???
              bgcolour = "bgcolor='#e3e3e3'";
            else
              bgcolour = "bgcolor='#FFFFFF'";
              
            out.println("      <tr>");
            out.println("       <td " + bgcolour +  " valign=\"top\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><a href=\"" + AusstageCommon.resource_index_search_result_drill_page + "&f_item_cat_id=" + crset.getString("itemid") + "\" onmouseover=\"this.style.cursor='hand';\">" + crset.getString("citation") + "</a></td>");

            
            out.println(      "</tr>");

            counter++;
                        
            if(counter == resultsPerPage)
              break;
          }
          
          start_trigger++;
          
        }while(crset.next());
       

        // PAGINATION DISPLAY //

        String unrounded_page_num = "";
        int rounded_num_pages     = 0;
        int remainder_num         = 0;
        int int_page_num          = 0;
        int i                     = 1;
          
        
        if(Integer.parseInt(recset_count) > resultsPerPage){
       
          out.println("      <tr>");
          out.println("       <td colspan=\"7\">&nbsp;</td>");
          out.println("      </tr>");
          out.println("      <tr>");
          out.println("       <td align=\"center\" colspan=\"7\" " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + ">");
         
          unrounded_page_num  = Double.toString(Double.parseDouble(Integer.toString(Integer.parseInt(recset_count))) / Double.parseDouble(resultsPerPage + ""));
          rounded_num_pages   = Integer.parseInt(unrounded_page_num.substring(0, unrounded_page_num.indexOf(".")));     // ie. 5.4 will return 5    
          remainder_num       = Integer.parseInt(unrounded_page_num.substring(unrounded_page_num.indexOf(".") + 1, unrounded_page_num.indexOf(".") + 2)); // ie. 5.4 will return 4          
          
          
          
          if(remainder_num > 0)
            rounded_num_pages++; // add another page if remainder > 0

          // convert the page_num to a useful mathematical type
          // and use it as the start number for our page numbering
          if(page_num != null){
            int_page_num = Integer.parseInt(page_num);

            // find the middle number so that if 10 is
            // hit(or the 'Next' & 'Previous' number)
            // the page number will display
            // 6 7 8 9 10 11 12 13 14 15
            if(int_page_num >= 10)
              i = int_page_num - 4;
          }


          
          out.println("<b>Result Page</b>:&nbsp;&nbsp;");
          
          // write Previous
          if(int_page_num > 1)
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num - 1) + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Previous</a>&nbsp;");

          
          // write page numbers
          counter = 0;
          for(; i < rounded_num_pages + 1; i++){
            String highlight_number_str = "";

            if(int_page_num == i)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else if(page_num == null && i == 1)
              highlight_number_str = "<b>" + Integer.toString(i) + "</b>";
            else
              highlight_number_str = Integer.toString(i);
              
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + i + 
                        "&f_recset_count=" + recset_count + 
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") + 
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">" + highlight_number_str + "</a>&nbsp;");

            counter++;
            if(counter == 10)
              break;
          }

          // write Next
          if(page_num != null){
            if((int_page_num) < rounded_num_pages){// display Next only if its under the rounded_num_pages count
              out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                          "&f_keyword=" + common.URLEncode(keyword) + 
                          "&f_search_from=" + table_to_search_from + 
                          "&f_page_num=" + (int_page_num + 1) + 
                          "&f_recset_count=" + recset_count + 
                          "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                          "&f_sort_by=" + request.getParameter("f_sort_by") +
                          "&f_search_within_search=" + search_within_search_for_result +
                          "\">Next</a>");
            }
          }else{
            out.println("<a href=\"" + request.getRequestURI() + "?xcid=" + xcid_for_result + 
                        "&f_keyword=" + common.URLEncode(keyword) + 
                        "&f_search_from=" + table_to_search_from + 
                        "&f_page_num=" + (int_page_num + 2) + 
                        "&f_recset_count=" + recset_count +
                        "&f_sql_switch=" + request.getParameter("f_sql_switch") +
                        "&f_sort_by=" + request.getParameter("f_sort_by") +
                        "&f_search_within_search=" + search_within_search_for_result +
                        "\">Next</a>");
          }
              
          out.println("       </td>");
          out.println("      </tr>");
        } 

        // External links to other sites
        out.println("      <tr>");
        out.println("       <td colspan='7' "+ ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + "><br><br>");
        //out.println("         <a target='_blank' href='" + AusstageCommon.collection_index_search_result_page + "&f_keyword=" + common.URLEncode(keyword) + "&f_sql_switch=and'>Click here</a> to search the Directory</a><br>");
        out.println("         Search <a target='_blank' href='" + google_search_string + "'>Google</a><br>");
        out.println("         Search <a target='_blank' href='" + picture_australia_search_string + "'>Picture Australia</a><br>");
        out.println("         Search <a target='_blank' href='" + australia_dancing_search_string + "'>Australia Dancing</a><br>");        out.println("       </td>");
        out.println("      </tr> ");
        
        out.println("     </table>");
     
      }else{
        out.println("<p " + ausstage_search_page_output_for_result.applyStyle(ausstage_search_appconstants_for_result.ST_PAGE_BODY) + 
                    ">Your search did not return any result.<br>Please refine " +
                    "your search criteria.</p>");
      }
      
    }
%>

<script language="javascript">
   
  function reloadList (){
    // it does not matter if the user enters any values in the search fields.
    // this submit is only to use the previous;y entered values to requery

    // set all values to '', only if the attribute.value is set do we change the value
    document.searchform.f_keyword.value = '';  
    document.searchform.f_search_from.value = '';
    //document.searchform.f_recset_count.value = '';
    document.searchform.f_sql_switch.value = '';
    document.searchform.f_sort_by.value = '';
    document.searchform.f_year.value = '';
    
    /*
    document.searchform.f_date_clause.value = '';

    document.searchform.f_yyyyfirstdate.value = '';
    document.searchform.f_mmfirstdate.value = '';
    document.searchform.f_ddfirstdate.value = '';

    document.searchform.f_yyyybetweenfromdate.value = '';
    document.searchform.f_mmbetweenfromdate.value = '';
    document.searchform.f_ddbetweenfromdate.value = '';

    document.searchform.f_yyyybetweentodate.value = '';
    document.searchform.f_mmbetweentodate.value = '';
    document.searchform.f_ddbetweentodate.value = '';
*/
    <% if (keyword != null && !keyword.equals("")) { %>
      document.searchform.f_keyword.value = <%="\"" + keyword + "\""%>;  
    <% } %>

    <% if (table_to_search_from != null && !table_to_search_from.equals("")) { %>
      document.searchform.f_search_from.value = <%="\"" +table_to_search_from + "\""%>;
    <% } %>

    //<% if (recset_count != null && !recset_count.equals("")) { %>
    //  document.searchform.f_recset_count.value = <%=recset_count%>;
    //<% } %>

    <% if (request.getParameter("f_sql_switch") != null && !request.getParameter("f_sql_switch").equals("")) { %>
      document.searchform.f_sql_switch.value = <%="\"" +request.getParameter("f_sql_switch") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_sort_by") != null && !request.getParameter("f_sort_by").equals("")) { %>
      document.searchform.f_sort_by.value = <%="\"" + request.getParameter("f_sort_by") + "\""%>;
    <% } %>
    
    
    <% if (request.getParameter("f_year") != null && !request.getParameter("f_year").equals("")) { %>
      document.searchform.f_year.value = <%="\"" + request.getParameter("f_year") + "\""%>;
    <% } %>
/*
    <% if (request.getParameter("f_date_clause") != null && !request.getParameter("f_date_clause").equals("")) { %>
      document.searchform.f_date_clause.value = <%="\"" + request.getParameter("f_date_clause") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_yyyyfirstdate") != null && !request.getParameter("f_yyyyfirstdate").equals("")) { %>
      document.searchform.f_yyyyfirstdate.value = <%="\"" + request.getParameter("f_yyyyfirstdate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_mmfirstdate") != null && !request.getParameter("f_mmfirstdate").equals("")) { %>
      document.searchform.f_mmfirstdate.value = <%="\"" + request.getParameter("f_mmfirstdate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_ddfirstdate") != null && !request.getParameter("f_ddfirstdate").equals("")) { %>
      document.searchform.f_ddfirstdate.value = <%="\"" + request.getParameter("f_ddfirstdate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_yyyybetweenfromdate") != null && !request.getParameter("f_yyyybetweenfromdate").equals("")) { %>
      document.searchform.f_yyyybetweenfromdate.value = <%="\"" + request.getParameter("f_yyyybetweenfromdate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_mmbetweenfromdate") != null && !request.getParameter("f_mmbetweenfromdate").equals("")) { %>
      document.searchform.f_mmbetweenfromdate.value = <%="\"" + request.getParameter("f_mmbetweenfromdate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_ddbetweenfromdate") != null && !request.getParameter("f_ddbetweenfromdate").equals("")) { %>
      document.searchform.f_ddbetweenfromdate.value = <%="\"" + request.getParameter("f_ddbetweenfromdate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_yyyybetweentodate") != null && !request.getParameter("f_yyyybetweentodate").equals("")) { %>
      document.searchform.f_yyyybetweentodate.value = <%="\"" + request.getParameter("f_yyyybetweentodate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_mmbetweentodate") != null && !request.getParameter("f_mmbetweentodate").equals("")) { %>
      document.searchform.f_mmbetweentodate.value = <%="\"" + request.getParameter("f_mmbetweentodate") + "\""%>;
    <% } %>

    <% if (request.getParameter("f_ddbetweentodate") != null && !request.getParameter("f_ddbetweentodate").equals("")) { %>
      document.searchform.f_ddbetweentodate.value = <%="\"" + request.getParameter("f_ddbetweentodate") + "\""%>;
    <% } %>



    for(var i = 0; i < document.resource_radio.inc_resources.length; i++) {
      if(document.resource_radio.inc_resources[i].checked) {
        document.searchform.inc_resources.value = document.resource_radio.inc_resources[i].value;
      }
    }
    */
    document.searchform.submit();
  }
  
  //-->
  </script>
<jsp:include page="../templates/admin-footer.jsp" />